<!DOCTYPE html>
<html lang="bn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>রক্তদান প্ল্যাটফর্ম</title>
    <!-- Loading Inter font and Tailwind CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Custom form-radio styling for better visibility */
        .form-radio {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            border: 2px solid #D1D5DB;
            background-color: white;
            transition: all 0.2s ease-in-out;
        }

        .form-radio:checked {
            border-color: transparent;
            background-color: currentColor;
            /* Uses the text color set by Tailwind */
            box-shadow: 0 0 0 3px white, 0 0 0 5px currentColor;
        }

        .form-radio:focus {
            outline: none;
        }

        /* Style for the PIN/Password input to center text and limit width */
        .pin-input {
            text-align: center;
            letter-spacing: 2px;
            font-weight: bold;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl p-6 sm:p-8 max-w-lg w-full relative">

        <!-- Message Box: Displayed by JS for feedback -->
        <div id="message-box"
            class="hidden fixed top-4 left-1/2 -translate-x-1/2 z-50 p-3 rounded-lg shadow-xl transition-all duration-300 transform min-w-[300px] text-center">
            <p id="message-text" class="text-sm font-medium"></p>
        </div>

        <div class="text-center">
            <h1 class="text-3xl font-bold mb-2 text-gray-800">রক্তদান প্ল্যাটফর্ম</h1>
            <p class="text-gray-500 mb-6 text-sm sm:text-base"></p>
        </div>
        <!-- User ID Display: Populated by JS for sharing -->
        <div id="userIdDisplay" class="text-xs text-gray-400 text-center mb-4 break-all p-2 bg-gray-50 rounded-lg">User
            ID: Loading...</div>

        <!-- 1. Main Role Selection -->
        <div id="main-selection" class="flex flex-col items-center">
            <h2 class="text-xl sm:text-2xl font-semibold mb-6 text-gray-700">আপনি কি:</h2>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 w-full">
                <button id="select-patient"
                    class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 sm:py-4 px-6 rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105">
                    রোগী (Patient)
                </button>
                <button id="select-donor"
                    class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 sm:py-4 px-6 rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105">
                    ডোনার (Donor)
                </button>
                <button id="select-hospital"
                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 sm:py-4 px-6 rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105">
                    হাসপাতাল (Hospital)
                </button>
            </div>
        </div>

        <!-- 1.5. AUTH SELECTION SCREENS -->

        <!-- Patient Auth Selection -->
        <div id="patient-auth-selection" class="hidden text-center space-y-6 pt-4">
            <h2 class="text-2xl font-semibold text-red-600">রোগী হিসেবে এগিয়ে যান</h2>
            <p class="text-gray-600">অনুগ্রহ করে আপনার বিকল্প নির্বাচন করুন:</p>
            <button id="patient-login-btn"
                class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105">
                ইতিমধ্যে অ্যাকাউন্ট আছে? লগইন করুন
            </button>
            <button id="patient-register-btn"
                class="w-full bg-red-100 text-red-700 font-bold py-3 rounded-xl shadow-lg hover:bg-red-200 transition-all duration-300 transform hover:scale-105">
                নতুন? নিবন্ধন করুন
            </button>
            <button class="back-button mt-4 w-full text-center text-gray-500 hover:text-gray-700 font-medium">← ফিরে
                যান</button>
        </div>

        <!-- Donor Auth Selection -->
        <div id="donor-auth-selection" class="hidden text-center space-y-6 pt-4">
            <h2 class="text-2xl font-semibold text-green-600">ডোনার হিসেবে এগিয়ে যান</h2>
            <p class="text-gray-600">অনুগ্রহ করে আপনার বিকল্প নির্বাচন করুন:</p>
            <button id="donor-login-btn"
                class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105">
                ইতিমধ্যে অ্যাকাউন্ট আছে? লগইন করুন
            </button>
            <button id="donor-register-btn"
                class="w-full bg-green-100 text-green-700 font-bold py-3 rounded-xl shadow-lg hover:bg-green-200 transition-all duration-300 transform hover:scale-105">
                নতুন? নিবন্ধন করুন
            </button>
            <button class="back-button mt-4 w-full text-center text-gray-500 hover:text-gray-700 font-medium">← ফিরে
                যান</button>
        </div>

        <!-- Hospital Auth Selection -->
        <div id="hospital-auth-selection" class="hidden text-center space-y-6 pt-4">
            <h2 class="text-2xl font-semibold text-blue-600">হাসপাতাল হিসেবে এগিয়ে যান</h2>
            <p class="text-gray-600">অনুগ্রহ করে আপনার বিকল্প নির্বাচন করুন:</p>
            <button id="hospital-login-btn"
                class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105">
                ইতিমধ্যে অ্যাকাউন্ট আছে? লগইন করুন
            </button>
            <button id="hospital-register-btn"
                class="w-full bg-blue-100 text-blue-700 font-bold py-3 rounded-xl shadow-lg hover:bg-blue-200 transition-all duration-300 transform hover:scale-105">
                নতুন? নিবন্ধন করুন
            </button>
            <button class="back-button mt-4 w-full text-center text-gray-500 hover:text-gray-700 font-medium">← ফিরে
                যান</button>
        </div>


        <!-- 2. LOGIN FORMS -->

        <!-- 2.1. Patient Login Form -->
        <div id="patient-login-form" class="hidden">
            <h2 class="text-2xl font-semibold mb-6 text-red-600 text-center">রোগী লগইন</h2>
            <form id="patient-login-details" class="space-y-4">
                <div>
                    <label for="patient-login-phone" class="block text-sm font-medium text-gray-700 mb-1">ফোন
                        নম্বর</label>
                    <input type="tel" id="patient-login-phone" placeholder="ফোন নম্বর (যেমন: 01xxxxxxxxx)" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 transition-all duration-200">
                </div>
                <div>
                    <label for="patient-login-pin" class="block text-sm font-medium text-gray-700 mb-1">৪-সংখ্যার
                        পিন/পাসওয়ার্ড</label>
                    <input type="password" id="patient-login-pin" placeholder="••••" required maxlength="4"
                        class="pin-input w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 transition-all duration-200">
                </div>
                <button type="submit" id="patient-login-submit-btn"
                    class="w-full bg-red-500 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-red-600 transition-all duration-200 transform hover:scale-105">লগইন
                    করুন</button>
            </form>
            <button class="back-to-auth mt-4 w-full text-center text-gray-500 hover:text-gray-700 font-medium"
                data-target="patient-auth-selection">← ফিরে যান</button>
        </div>

        <!-- 2.2. Donor Login Form -->
        <div id="donor-login-form" class="hidden">
            <h2 class="text-2xl font-semibold mb-6 text-green-600 text-center">ডোনার লগইন</h2>
            <form id="donor-login-details" class="space-y-4">
                <div>
                    <label for="donor-login-phone" class="block text-sm font-medium text-gray-700 mb-1">ফোন
                        নম্বর</label>
                    <input type="tel" id="donor-login-phone" placeholder="ফোন নম্বর (যেমন: 01xxxxxxxxx)" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-200">
                </div>
                <div>
                    <label for="donor-login-pin" class="block text-sm font-medium text-gray-700 mb-1">৪-সংখ্যার
                        পিন/পাসওয়ার্ড</label>
                    <input type="password" id="donor-login-pin" placeholder="••••" required maxlength="4"
                        class="pin-input w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-200">
                </div>
                <button type="submit" id="donor-login-submit-btn"
                    class="w-full bg-green-500 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-green-600 transition-all duration-200 transform hover:scale-105">লগইন
                    করুন</button>
            </form>
            <button class="back-to-auth mt-4 w-full text-center text-gray-500 hover:text-gray-700 font-medium"
                data-target="donor-auth-selection">← ফিরে যান</button>
        </div>

        <!-- 2.3. Hospital Login Form -->
        <div id="hospital-login-form" class="hidden">
            <h2 class="text-2xl font-semibold mb-6 text-blue-600 text-center">হাসপাতাল লগইন</h2>
            <form id="hospital-login-details" class="space-y-4">
                <div>
                    <label for="hospital-login-license" class="block text-sm font-medium text-gray-700 mb-1">হাসপাতাল
                        লাইসেন্স নম্বর (ID)</label>
                    <input type="text" id="hospital-login-license" placeholder="লাইসেন্স নম্বর" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
                </div>
                <div>
                    <label for="hospital-login-pin" class="block text-sm font-medium text-gray-700 mb-1">৪-সংখ্যার
                        পিন/পাসওয়ার্ড</label>
                    <input type="password" id="hospital-login-pin" placeholder="••••" required maxlength="4"
                        class="pin-input w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
                </div>
                <button type="submit" id="hospital-login-submit-btn"
                    class="w-full bg-blue-500 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-blue-600 transition-all duration-200 transform hover:scale-105">লগইন
                    করুন</button>
            </form>
            <button class="back-to-auth mt-4 w-full text-center text-gray-500 hover:text-gray-700 font-medium"
                data-target="hospital-auth-selection">← ফিরে যান</button>
        </div>


        <!-- 3. REGISTRATION FORMS -->

        <!-- 3.1. Patient Registration Form -->
        <div id="patient-form" class="hidden">
            <h2 class="text-2xl font-semibold mb-6 text-red-700 text-center">রোগী নিবন্ধন: রক্ত প্রয়োজন?</h2>
            <form id="patient-form-details" class="space-y-4">
                <div>
                    <label for="patient-name" class="block text-sm font-medium text-gray-700 mb-1">আপনার নাম</label>
                    <input type="text" id="patient-name" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 transition-all duration-200">
                </div>
                <div>
                    <label for="patient-phone" class="block text-sm font-medium text-gray-700 mb-1">ফোন নম্বর</label>
                    <div class="flex items-center space-x-2">
                        <input type="tel" id="patient-phone" placeholder="ফোন নম্বর (যেমন: 01xxxxxxxxx)" required
                            class="flex-grow px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 transition-all duration-200">
                        <button type="button" id="send-patient-otp"
                            class="bg-red-200 text-red-700 px-4 py-2 rounded-xl text-sm hover:bg-red-300 transition-all duration-200">OTP
                            পাঠান (Simulated)</button>
                    </div>
                </div>
                <div>
                    <label for="patient-pin" class="block text-sm font-medium text-gray-700 mb-1">৪-সংখ্যার পিন (লগইন এর
                        জন্য)</label>
                    <input type="password" id="patient-pin" placeholder="••••" required minlength="4" maxlength="4"
                        pattern="\d{4}" title="৪টি সংখ্যা লিখুন"
                        class="pin-input w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 transition-all duration-200">
                </div>
                <div>
                    <label for="patient-blood-group" class="block text-sm font-medium text-gray-700 mb-1">রক্তের
                        গ্রুপ</label>
                    <select id="patient-blood-group" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 transition-all duration-200">
                        <option value="">একটি রক্তের গ্রুপ নির্বাচন করুন</option>
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                    </select>
                </div>
                <!-- Location Fields (District, Upazila, Hospital, Location) -->
                <div><label for="patient-district"
                        class="block text-sm font-medium text-gray-700 mb-1">জেলা</label><input list="districts-list"
                        id="patient-district" placeholder="জেলা টাইপ বা নির্বাচন করুন" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 transition-all duration-200"><datalist
                        id="districts-list"></datalist></div>
                <div><label for="patient-sub-district"
                        class="block text-sm font-medium text-gray-700 mb-1">উপজেলা</label><input list="upazilas-list"
                        id="patient-sub-district" placeholder="উপজেলা টাইপ বা নির্বাচন করুন" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 transition-all duration-200"><datalist
                        id="upazilas-list"></datalist></div>
                <div><label for="patient-hospital-name" class="block text-sm font-medium text-gray-700 mb-1">হাসপাতালের
                        নাম (ঐচ্ছিক)</label><input list="hospitals-list" id="patient-hospital-name"
                        placeholder="হাসপাতাল টাইপ বা নির্বাচন করুন"
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 transition-all duration-200"><datalist
                        id="hospitals-list"></datalist></div>

                <div class="space-y-2"><label for="patient-address"
                        class="block text-sm font-medium text-gray-700 mb-1">ঠিকানা / এলাকা (Address/Area)</label><input
                        type="text" id="patient-address" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 transition-all duration-200"
                        placeholder="যেমন: বাসা ১২, সড়ক ৫, মিরপুর, ঢাকা"></div>

                <div class="space-y-2"><label for="patient-available-time"
                        class="block text-sm font-medium text-gray-700 mb-1">প্রাপ্য সময় (Available Time)</label><input
                        type="text" id="patient-available-time" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 transition-all duration-200"
                        placeholder="যেমন: সকাল ১০টা - বিকেল ৫টা"></div>

                <div class="space-y-2">
                    <p class="block text-sm font-medium text-gray-700">ডোনেশনের ধরণ (Donation Type)</p>
                    <label class="flex items-center space-x-2 text-gray-600"><input type="radio" name="donation-type"
                            value="free" class="form-radio text-red-500" checked><span>আমার একটি বিনামূল্যে ডোনেশন
                            প্রয়োজন</span></label>
                    <label class="flex items-center space-x-2 text-gray-600"><input type="radio" name="donation-type"
                            value="paid" class="form-radio text-red-500"><span>আমি রক্ত কিনতে ইচ্ছুক</span></label>
                    <label class="flex items-center space-x-2 text-gray-600"><input type="radio" name="donation-type"
                            value="either" class="form-radio text-red-500"><span>আমি যেকোনোটির জন্য খোলা</span></label>
                </div>
                <div>
                    <label for="patient-additional-info" class="block text-sm font-medium text-gray-700 mb-1">অতিরিক্ত
                        তথ্য (ঐচ্ছিক)</label>
                    <textarea id="patient-additional-info" rows="3"
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 transition-all duration-200"></textarea>
                </div>
                <button type="submit" id="patient-submit-btn"
                    class="w-full bg-red-500 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-red-600 transition-all duration-200 transform hover:scale-105">অনুরোধ
                    জমা দিন</button>
            </form>
            <button class="back-to-auth mt-4 w-full text-center text-gray-500 hover:text-gray-700 font-medium"
                data-target="patient-auth-selection">← ফিরে যান</button>
        </div>

        <!-- 3.2. Donor Registration Form -->
        <div id="donor-form" class="hidden">
            <h2 class="text-2xl font-semibold mb-6 text-green-700 text-center">ডোনার নিবন্ধন: ডোনার হতে চান?</h2>
            <form id="donor-form-details" class="space-y-4">
                <div><label for="donor-name" class="block text-sm font-medium text-gray-700 mb-1">আপনার
                        নাম</label><input type="text" id="donor-name" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-200">
                </div>
                <div>
                    <label for="donor-phone" class="block text-sm font-medium text-gray-700 mb-1">ফোন নম্বর</label>
                    <div class="flex items-center space-x-2">
                        <input type="tel" id="donor-phone" placeholder="ফোন নম্বর (যেমন: 01xxxxxxxxx)" required
                            class="flex-grow px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-200">
                        <button type="button" id="send-donor-otp"
                            class="bg-green-200 text-green-700 px-4 py-2 rounded-xl text-sm hover:bg-green-300 transition-all duration-200">OTP
                            পাঠান (Simulated)</button>
                    </div>
                </div>
                <div>
                    <label for="donor-pin" class="block text-sm font-medium text-gray-700 mb-1">৪-সংখ্যার পিন (লগইন এর
                        জন্য)</label>
                    <input type="password" id="donor-pin" placeholder="••••" required minlength="4" maxlength="4"
                        pattern="\d{4}" title="৪টি সংখ্যা লিখুন"
                        class="pin-input w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-200">
                </div>
                <div>
                    <label for="donor-blood-group" class="block text-sm font-medium text-gray-700 mb-1">রক্তের
                        গ্রুপ</label>
                    <select id="donor-blood-group" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-200">
                        <option value="">একটি রক্তের গ্রুপ নির্বাচন করুন</option>
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                    </select>
                </div>
                <div><label for="donor-district" class="block text-sm font-medium text-gray-700 mb-1">জেলা</label><input
                        list="districts-list" id="donor-district" placeholder="জেলা টাইপ বা নির্বাচন করুন" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-200">
                </div>
                <div><label for="donor-sub-district"
                        class="block text-sm font-medium text-gray-700 mb-1">উপজেলা</label><input list="upazilas-list"
                        id="donor-sub-district" placeholder="উপজেলা টাইপ বা নির্বাচন করুন" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-200">
                </div>
                <div class="space-y-2"><label for="donor-address"
                        class="block text-sm font-medium text-gray-700 mb-1">ঠিকানা / এলাকা (Address/Area)</label><input
                        type="text" id="donor-address" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-200"
                        placeholder="যেমন: বাসা ১২, সড়ক ৫, মিরপুর, ঢাকা"></div>

                <div class="space-y-2">
                    <p class="block text-sm font-medium text-gray-700">ডোনেশনের অগ্রাধিকার</p>
                    <label class="flex items-center space-x-2 text-gray-600"><input type="radio"
                            name="donation-preference" value="free" class="form-radio text-green-500" checked><span>আমি
                            বিনামূল্যে দান করতে চাই</span></label>
                    <label class="flex items-center space-x-2 text-gray-600"><input type="radio"
                            name="donation-preference" value="sell" class="form-radio text-green-500"><span>আমি আমার
                            রক্ত বিক্রি করতে চাই</span></label>
                    <label class="flex items-center space-x-2 text-gray-600"><input type="radio"
                            name="donation-preference" value="both" class="form-radio text-green-500"><span>আমি উভয়ের
                            জন্য উপলব্ধ</span></label>
                </div>
                <button type="submit" id="donor-submit-btn"
                    class="w-full bg-green-500 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-green-600 transition-all duration-200 transform hover:scale-105">ডোনার
                    হিসেবে নিবন্ধন করুন</button>
            </form>
            <button class="back-to-auth mt-4 w-full text-center text-gray-500 hover:text-gray-700 font-medium"
                data-target="donor-auth-selection">← ফিরে যান</button>
        </div>

        <!-- 3.3. Hospital Registration Form -->
        <div id="hospital-form" class="hidden">
            <h2 class="text-2xl font-semibold mb-6 text-blue-700 text-center">হাসপাতাল নিবন্ধন: রক্তের জন্য অনুরোধ</h2>
            <form id="hospital-form-details" class="space-y-4">
                <div><label for="hospital-name" class="block text-sm font-medium text-gray-700 mb-1">আপনার হাসপাতালের
                        নাম</label><input type="text" id="hospital-name" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
                </div>
                <div><label for="hospital-license" class="block text-sm font-medium text-gray-700 mb-1">হাসপাতাল
                        লাইসেন্স নম্বর (ID)</label><input type="text" id="hospital-license" placeholder="লাইসেন্স নম্বর"
                        required
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
                </div>
                <div>
                    <label for="hospital-pin" class="block text-sm font-medium text-gray-700 mb-1">৪-সংখ্যার পিন (লগইন
                        এর জন্য)</label>
                    <input type="password" id="hospital-pin" placeholder="••••" required minlength="4" maxlength="4"
                        pattern="\d{4}" title="৪টি সংখ্যা লিখুন"
                        class="pin-input w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
                </div>

                <div class="space-y-2">
                    <p class="block text-sm font-medium text-gray-700">অনুরোধের ধরণ</p>
                    <label class="flex items-center space-x-2 text-gray-600"><input type="radio"
                            name="hospital-request-type" value="free" class="form-radio text-blue-500"
                            checked><span>বিনামূল্যে ডোনেশনের জন্য অনুরোধ</span></label>
                    <label class="flex items-center space-x-2 text-gray-600"><input type="radio"
                            name="hospital-request-type" value="paid" class="form-radio text-blue-500"><span>কেনা রক্তের
                            জন্য অনুরোধ</span></label>
                </div>
                <div>
                    <label for="hospital-patient-form" class="block text-sm font-medium text-gray-700 mb-1">রোগীর ফর্ম ও
                        তথ্য (একটি ছবি হিসেবে)</label>
                    <input type="file" id="hospital-patient-form" required accept="image/*"
                        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
                    <p class="text-xs text-gray-400 mt-1">
                        **ফাইল আপলোড সিমুলেটেড।**
                    </p>
                </div>
                <button type="submit" id="hospital-submit-btn"
                    class="w-full bg-blue-500 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-blue-600 transition-all duration-200 transform hover:scale-105">অনুরোধ
                    জমা দিন</button>
                <div id="receipt-message" class="hidden mt-4 p-4 rounded-xl bg-green-100 text-green-700">
                    <p>
                        **সিমুলেটেড রসিদ:** রোগীর ফোনে একটি স্বয়ংক্রিয় রসিদ বার্তা পাঠানো হয়েছে।
                    </p>
                </div>
            </form>
            <button class="back-to-auth mt-4 w-full text-center text-gray-500 hover:text-gray-700 font-medium"
                data-target="hospital-auth-selection">← ফিরে যান</button>
        </div>

        <!-- 4. DASHBOARD SCREENS (New Feature) -->

        <!-- 4.1. Patient Dashboard -->
        <div id="patient-dashboard" class="hidden">
            <h2 class="text-2xl font-semibold mb-6 text-red-600 text-center">রোগী ড্যাশবোর্ড</h2>
            <div class="bg-red-50 p-4 rounded-xl space-y-4">
                <p class="text-lg font-bold text-red-700">স্বাগতম, <span id="dash-patient-name">রোগী!</span></p>
                <p class="text-sm text-gray-600">আপনি আপনার বর্তমান **রক্তের অনুরোধের স্থিতি** এবং **ড্রাফ্ট
                    রিকুয়েস্টগুলি** এখানে দেখতে পাবেন।</p>
                <div class="space-y-2">
                    <h3 class="font-medium text-red-600">বর্তমান অনুরোধ (একটি)</h3>
                    <div class="p-3 bg-white rounded-lg shadow-sm border border-red-200">
                        <p class="text-sm font-medium">রক্তের গ্রুপ: B+ | অবস্থা: **ম্যাচিং হচ্ছে...**</p>
                        <p class="text-xs text-gray-500 mt-1">তারিখ: ২০২৫/১১/০৬ | হাসপাতাল: ঢাকা মেডিকেল কলেজ</p>
                    </div>
                </div>
                <div class="space-y-2">
                    <h3 class="font-medium text-red-600">ড্রাফ্ট রিকুয়েস্ট</h3>
                    <div class="p-3 bg-gray-100 rounded-lg shadow-inner">
                        <p class="text-sm text-gray-700">একটি O- রক্তের জন্য অনুরোধের ড্রাফ্ট সেভ করা আছে।</p>
                        <button class="text-xs text-red-500 hover:text-red-700 mt-1">সম্পূর্ণ করুন/মুছুন</button>
                    </div>
                </div>
            </div>
            <button id="patient-logout"
                class="w-full bg-gray-200 text-gray-700 font-bold py-3 rounded-xl shadow-lg hover:bg-gray-300 transition-all duration-200 mt-6">লগআউট</button>
        </div>

        <!-- 4.2. Donor Dashboard -->
        <div id="donor-dashboard" class="hidden">
            <h2 class="text-2xl font-semibold mb-6 text-green-600 text-center">ডোনার ড্যাশবোর্ড</h2>
            <div class="bg-green-50 p-4 rounded-xl space-y-4">
                <p class="text-lg font-bold text-green-700">স্বাগতম, <span id="dash-donor-name">ডোনার!</span></p>
                <p class="text-sm text-gray-600">এখানে আপনি আপনার **প্রাপ্যতা** এবং **নতুন অনুরোধগুলি** দেখতে পাবেন।</p>
                <div class="space-y-2">
                    <h3 class="font-medium text-green-600">নিকটবর্তী অনুরোধ</h3>
                    <div class="p-3 bg-white rounded-lg shadow-sm border border-green-200">
                        <p class="text-sm font-medium">রক্তের গ্রুপ: A+ প্রয়োজন। (খুলনা সিটি হাসপাতাল)</p>
                        <p class="text-xs text-gray-500 mt-1">তাড়াতাড়ি প্রয়োজন। যোগাযোগের জন্য ক্লিক করুন।</p>
                        <button class="text-xs text-green-500 hover:text-green-700 mt-2">যোগাযোগ করুন</button>
                    </div>
                </div>
                <div class="space-y-2">
                    <h3 class="font-medium text-green-600">ডোনেশন হিস্টরি (ড্রাফ্ট)</h3>
                    <div class="p-3 bg-gray-100 rounded-lg shadow-inner">
                        <p class="text-sm text-gray-700">সেপ্টেম্বর মাসে ২ বার ডোনেশন করা হয়েছিল।</p>
                        <button class="text-xs text-green-500 hover:text-green-700 mt-1">সম্পূর্ণ হিস্টরি দেখুন</button>
                    </div>
                </div>
            </div>
            <button id="donor-logout"
                class="w-full bg-gray-200 text-gray-700 font-bold py-3 rounded-xl shadow-lg hover:bg-gray-300 transition-all duration-200 mt-6">লগআউট</button>
        </div>

        <!-- 4.3. Hospital Dashboard -->
        <div id="hospital-dashboard" class="hidden">
            <h2 class="text-2xl font-semibold mb-6 text-blue-600 text-center">হাসপাতাল ড্যাশবোর্ড</h2>
            <div class="bg-blue-50 p-4 rounded-xl space-y-4">
                <p class="text-lg font-bold text-blue-700">স্বাগতম, <span id="dash-hospital-name">হাসপাতাল!</span></p>
                <p class="text-sm text-gray-600">এখানে আপনি **ডোনার ম্যাচিং** এবং **পেণ্ডিং রিকুয়েস্ট** দেখতে পাবেন।
                </p>
                <div class="space-y-2">
                    <h3 class="font-medium text-blue-600">পেণ্ডিং অনুরোধ</h3>
                    <div class="p-3 bg-white rounded-lg shadow-sm border border-blue-200">
                        <p class="text-sm font-medium">রোগী: #৭৮৯ | রক্তের গ্রুপ: O-</p>
                        <p class="text-xs text-gray-500 mt-1">অবস্থা: ৩ জন ডোনারের সাথে ম্যাচিং হয়েছে।</p>
                    </div>
                </div>
                <div class="space-y-2">
                    <h3 class="font-medium text-blue-600">ড্রাফ্ট রিপোর্ট</h3>
                    <div class="p-3 bg-gray-100 rounded-lg shadow-inner">
                        <p class="text-sm text-gray-700">অসম্পূর্ণ ডোনার ম্যাচিং রিপোর্ট সেভ করা আছে।</p>
                        <button class="text-xs text-blue-500 hover:text-blue-700 mt-1">সম্পূর্ণ করুন</button>
                    </div>
                </div>
            </div>
            <button id="hospital-logout"
                class="w-full bg-gray-200 text-gray-700 font-bold py-3 rounded-xl shadow-lg hover:bg-gray-300 transition-all duration-200 mt-6">লগআউট</button>
        </div>
    </div>

    <!-- JavaScript Code (Handles all logic and simulation) -->
    <script type="module">
        // --- SUPABASE INITIALIZATION ---

        // GLOBAL VARIABLES
        const YOUR_SUPABASE_URL = "https://xmnlkfcazmjommwvbptq.supabase.co";
        const YOUR_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhtbmxrZmNhem1qb21td3ZicHRxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxNzEwNzksImV4cCI6MjA3OTc0NzA3OX0.S_7HkXahzs3hqDno-XOs2pkpHxcxAwMnhD4Gv8laS0Y";

        let supabase;
        let currentUser = null;
        let currentUserRole = null;

        function initSupabase() {
            try {
                supabase = window.supabase.createClient(YOUR_SUPABASE_URL, YOUR_SUPABASE_ANON_KEY);
                console.log("Supabase initialized");
            } catch (err) {
                console.error("Supabase init error:", err);
                showMessage("ডাটাবেস সংযোগে সমস্যা হয়েছে।", 'error');
            }
        }

        // --- UTILS ---
        function showMessage(text, type = 'success') {
            const msgBox = document.getElementById('message-box');
            const msgText = document.getElementById('message-text');
            msgText.textContent = text;
            msgBox.className = 'fixed top-4 left-1/2 -translate-x-1/2 z-50 p-3 rounded-lg shadow-xl transition-all duration-300 transform min-w-[300px] text-center';

            if (type === 'error') msgBox.classList.add('bg-red-100', 'text-red-700');
            else if (type === 'success') msgBox.classList.add('bg-green-100', 'text-green-700');
            else msgBox.classList.add('bg-yellow-100', 'text-yellow-700');

            msgBox.classList.remove('hidden');
            setTimeout(() => msgBox.classList.add('hidden'), 5000);
        }

        function showScreen(screenId) {
            const screens = [
                'main-selection', 'patient-auth-selection', 'donor-auth-selection', 'hospital-auth-selection',
                'patient-login-form', 'donor-login-form', 'hospital-login-form',
                'patient-form', 'donor-form', 'hospital-form',
                'patient-dashboard', 'donor-dashboard', 'hospital-dashboard'
            ];
            screens.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.toggle('hidden', id !== screenId);
            });
            document.getElementById('receipt-message')?.classList.add('hidden');
        }

        function validateInput(value, type) {
            if (!value) return false;
            // Simplified validation as per request "login credentials will be phone number and 4 digit pin"
            if (type === 'phone') return /^01\d{9}$/.test(value);
            if (type === 'pin') return /^\d{4}$/.test(value);
            return value.trim().length > 0;
        }

        // --- AUTH LOGIC (CUSTOM TABLE AUTH) ---

        async function handleLogin(event, role) {
            event.preventDefault();

            let identifier, pin, table;

            if (role === 'patient') {
                identifier = document.getElementById('patient-login-phone').value.trim();
                pin = document.getElementById('patient-login-pin').value.trim();
                table = 'patients';
            } else if (role === 'donor') {
                identifier = document.getElementById('donor-login-phone').value.trim();
                pin = document.getElementById('donor-login-pin').value.trim();
                table = 'donors';
            } else { // hospital
                identifier = document.getElementById('hospital-login-license').value.trim();
                pin = document.getElementById('hospital-login-pin').value.trim();
                table = 'hospitals';
            }

            if (!identifier || !pin) {
                showMessage("সব তথ্য পূরণ করুন", 'error');
                return;
            }

            try {
                // Query the specific table for the user
                const { data, error } = await supabase
                    .from(table)
                    .select('*')
                    .eq('identifier', identifier)
                    .single();

                if (error || !data) {
                    // Supabase returns error for .single() if 0 or >1 rows
                    console.error("Login lookup error:", error);
                    showMessage("ব্যবহারকারী পাওয়া যায়নি। সঠিক তথ্য দিন।", 'error');
                    return;
                }

                if (data.pin !== pin) {
                    showMessage("পিন ভুল হয়েছে।", 'error');
                    return;
                }

                // Login Success
                currentUser = data;
                currentUserRole = role;

                // Update Dashboard Name
                const dashNameEl = document.getElementById(`dash-${role}-name`);
                if (dashNameEl) dashNameEl.textContent = data.name || data.hospital_name || "User";

                showMessage("লগইন সফল!", 'success');
                event.target.reset();
                showScreen(`${role}-dashboard`);

            } catch (err) {
                console.error("Login Unexpected Error:", err);
                showMessage("লগইন ব্যর্থ হয়েছে।", 'error');
            }
        }

        async function handleRegistration(event, role) {
            event.preventDefault();
            const form = event.target;
            const insertData = {};
            let table = '';

            // Common validations could go here, but we'll specific extraction

            if (role === 'patient') {
                table = 'patients';
                const phone = document.getElementById('patient-phone').value.trim();
                const pin = document.getElementById('patient-pin').value.trim();

                if (!validateInput(phone, 'phone') || !validateInput(pin, 'pin')) {
                    showMessage("সঠিক ফোন ও পিন দিন।", 'error'); return;
                }

                insertData.identifier = phone;
                insertData.pin = pin;
                insertData.name = document.getElementById('patient-name').value.trim();
                insertData.blood_group = document.getElementById('patient-blood-group').value;
                insertData.district = document.getElementById('patient-district').value;
                insertData.sub_district = document.getElementById('patient-sub-district').value; // Changed ID to match new HTML
                insertData.address = document.getElementById('patient-address').value; // Changed ID to match new HTML
                insertData.available_time = document.getElementById('patient-available-time').value; // New Field 
                insertData.donation_type = form.querySelector('input[name="donation-type"]:checked')?.value;
                insertData.additional_info = document.getElementById('patient-additional-info')?.value;

            } else if (role === 'donor') {
                table = 'donors';
                const phone = document.getElementById('donor-phone').value.trim();
                const pin = document.getElementById('donor-pin').value.trim();
                if (!validateInput(phone, 'phone') || !validateInput(pin, 'pin')) {
                    showMessage("সঠিক ফোন ও পিন দিন।", 'error'); return;
                }

                insertData.identifier = phone;
                insertData.pin = pin;
                insertData.name = document.getElementById('donor-name').value.trim();
                insertData.blood_group = document.getElementById('donor-blood-group').value;
                insertData.district = document.getElementById('donor-district').value;
                insertData.sub_district = document.getElementById('donor-sub-district').value; // New ID
                insertData.address = document.getElementById('donor-address').value; // New ID
                insertData.donation_type = form.querySelector('input[name="donation-preference"]:checked')?.value;

            } else if (role === 'hospital') {
                table = 'hospitals';
                const license = document.getElementById('hospital-license').value.trim();
                const pin = document.getElementById('hospital-pin').value.trim();

                if (!license || !validateInput(pin, 'pin')) {
                    showMessage("সঠিক লাইসেন্স ও পিন দিন।", 'error'); return;
                }

                insertData.identifier = license;
                insertData.pin = pin;
                insertData.hospital_name = document.getElementById('hospital-name').value.trim();
                insertData.donation_type = form.querySelector('input[name="hospital-request-type"]:checked')?.value;

                const fileInput = document.getElementById('hospital-patient-form');
                if (fileInput && fileInput.files.length > 0) {
                    insertData.patient_form_file = fileInput.files[0].name;
                }
            }

            try {
                // Check if already exists (optional but good UI)
                const { data: existing } = await supabase.from(table).select('id').eq('identifier', insertData.identifier).maybeSingle();
                if (existing) {
                    showMessage("এই অ্যাকাউন্ট ইতিমধ্যে বিদ্যমান।", 'error');
                    return;
                }

                const { error } = await supabase.from(table).insert([insertData]);

                if (error) {
                    console.error("Registration DB Error:", error);
                    showMessage("নিবন্ধন ব্যর্থ: " + error.message, 'error');
                } else {
                    showMessage("নিবন্ধন সফল! এখন লগইন করুন।", 'success');
                    form.reset();
                    showScreen(`${role}-auth-selection`);
                }

            } catch (err) {
                console.error("Registration Unexpected Error:", err);
                showMessage("ত্রুটি: " + err.message, 'error');
            }
        }

        function handleLogout() {
            currentUser = null;
            currentUserRole = null;
            showMessage("লগআউট হয়েছে।", 'info');
            showScreen('main-selection');
        }

        // --- INIT ---
        window.onload = function () {
            initSupabase();

            // Populate datalists
            const districts = ["ঢাকা", "চট্টগ্রাম", "খুলনা", "সিলেট", "রাজশাহী", "বরিশাল", "রংপুর"];
            const subDistricts = ["মিরপুর", "গুলশান", "ধানমন্ডি", "বাড্ডা", "সাভার"]; // Simplified
            const hospitals = ["ঢাকা মেডিকেল কলেজ", "খুলনা সিটি হাসপাতাল"];

            const fillC = (id, arr) => {
                const el = document.getElementById(id);
                if (el) el.innerHTML = arr.map(i => `<option value="${i}">`).join('');
            };
            fillC('districts-list', districts);
            fillC('upazilas-list', subDistricts);
            fillC('hospitals-list', hospitals);

            // Listeners
            // Nav
            document.getElementById('select-patient').onclick = () => showScreen('patient-auth-selection');
            document.getElementById('select-donor').onclick = () => showScreen('donor-auth-selection');
            document.getElementById('select-hospital').onclick = () => showScreen('hospital-auth-selection');
            document.querySelectorAll('.back-button').forEach(b => b.onclick = () => showScreen('main-selection'));
            document.querySelectorAll('.back-to-auth').forEach(b => b.onclick = (e) => showScreen(e.target.dataset.target));

            // Forms - Login
            document.getElementById('patient-login-btn').onclick = () => showScreen('patient-login-form');
            document.getElementById('donor-login-btn').onclick = () => showScreen('donor-login-form');
            document.getElementById('hospital-login-btn').onclick = () => showScreen('hospital-login-form');

            document.getElementById('patient-login-details').onsubmit = (e) => handleLogin(e, 'patient');
            document.getElementById('donor-login-details').onsubmit = (e) => handleLogin(e, 'donor');
            document.getElementById('hospital-login-details').onsubmit = (e) => handleLogin(e, 'hospital');

            // Forms - Register
            document.getElementById('patient-register-btn').onclick = () => showScreen('patient-form');
            document.getElementById('donor-register-btn').onclick = () => showScreen('donor-form');
            document.getElementById('hospital-register-btn').onclick = () => showScreen('hospital-form');

            document.getElementById('patient-form-details').onsubmit = (e) => handleRegistration(e, 'patient');
            document.getElementById('donor-form-details').onsubmit = (e) => handleRegistration(e, 'donor');
            document.getElementById('hospital-form-details').onsubmit = (e) => handleRegistration(e, 'hospital');

            // Logout
            document.getElementById('patient-logout').onclick = handleLogout;
            document.getElementById('donor-logout').onclick = handleLogout;
            document.getElementById('hospital-logout').onclick = handleLogout;

            // Start
            showScreen('main-selection');
        };
    </script>
</body>

</html>